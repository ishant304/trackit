"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parse = void 0;
const http_1 = __importDefault(require("http"));
const https_1 = __importDefault(require("https"));
const cheerio_1 = __importDefault(require("cheerio"));
function httpGet(url) {
    return new Promise((resolve, reject) => {
        const protocol = url.startsWith('https://') ? https_1.default : http_1.default;
        const req = protocol.get(url, (res) => {
            const statusCode = res.statusCode === undefined ? -1 : res.statusCode;
            if (statusCode !== 200) {
                reject(new Error(`Status Code: ${statusCode}`));
                return;
            }
            const buffs = [];
            res.on('data', (chunk) => {
                buffs.push(chunk);
            });
            res.on('end', () => {
                resolve(Buffer.concat(buffs));
            });
            res.on('error', (err) => {
                reject(err);
            });
        });
        req.on('error', (err) => {
            reject(err);
        });
    });
}
function parseHtml(htmlBuffer, selectors) {
    const $ = cheerio_1.default.load(htmlBuffer);
    return [$, $(selectors)];
}
async function parse(url, selectors) {
    const htmlBuffer = await httpGet(url);
    return parseHtml(htmlBuffer, selectors);
}
exports.parse = parse;
